<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React.memo() 和 useMemo() 的用法与区别 | note</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/logo.webp">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="知识归纳总结">
    <meta name="keywords" content="blog,react,node,js">
    
    <link rel="preload" href="/assets/css/0.styles.b4a844ec.css" as="style"><link rel="preload" href="/assets/js/app.447fea52.js" as="script"><link rel="preload" href="/assets/js/2.57da4f88.js" as="script"><link rel="preload" href="/assets/js/1.a76cc220.js" as="script"><link rel="preload" href="/assets/js/150.56dd1be8.js" as="script"><link rel="prefetch" href="/assets/js/10.50f73657.js"><link rel="prefetch" href="/assets/js/100.6be385a1.js"><link rel="prefetch" href="/assets/js/101.81462761.js"><link rel="prefetch" href="/assets/js/102.c8574913.js"><link rel="prefetch" href="/assets/js/103.edf4da17.js"><link rel="prefetch" href="/assets/js/104.957e299a.js"><link rel="prefetch" href="/assets/js/105.62db7699.js"><link rel="prefetch" href="/assets/js/106.5bb35c23.js"><link rel="prefetch" href="/assets/js/107.a7d99347.js"><link rel="prefetch" href="/assets/js/108.e5a534df.js"><link rel="prefetch" href="/assets/js/109.6cbde664.js"><link rel="prefetch" href="/assets/js/11.0390ceee.js"><link rel="prefetch" href="/assets/js/110.c26bacc8.js"><link rel="prefetch" href="/assets/js/111.9360a59a.js"><link rel="prefetch" href="/assets/js/112.8cd53094.js"><link rel="prefetch" href="/assets/js/113.d0ebeec4.js"><link rel="prefetch" href="/assets/js/114.ec19f01c.js"><link rel="prefetch" href="/assets/js/115.4d3a89e6.js"><link rel="prefetch" href="/assets/js/116.a2a462f7.js"><link rel="prefetch" href="/assets/js/117.722c988a.js"><link rel="prefetch" href="/assets/js/118.f713753b.js"><link rel="prefetch" href="/assets/js/119.0125b80b.js"><link rel="prefetch" href="/assets/js/12.f88bec36.js"><link rel="prefetch" href="/assets/js/120.cd8ba30b.js"><link rel="prefetch" href="/assets/js/121.4c137fcb.js"><link rel="prefetch" href="/assets/js/122.d242343d.js"><link rel="prefetch" href="/assets/js/123.cdd643cd.js"><link rel="prefetch" href="/assets/js/124.a166a490.js"><link rel="prefetch" href="/assets/js/125.91acf062.js"><link rel="prefetch" href="/assets/js/126.09c27dbc.js"><link rel="prefetch" href="/assets/js/127.0d254650.js"><link rel="prefetch" href="/assets/js/128.431a6444.js"><link rel="prefetch" href="/assets/js/129.421c57ef.js"><link rel="prefetch" href="/assets/js/13.963ad03b.js"><link rel="prefetch" href="/assets/js/130.f980bd2e.js"><link rel="prefetch" href="/assets/js/131.f5d4dec1.js"><link rel="prefetch" href="/assets/js/132.b5fe7c86.js"><link rel="prefetch" href="/assets/js/133.e21e8968.js"><link rel="prefetch" href="/assets/js/134.cfde36a7.js"><link rel="prefetch" href="/assets/js/135.e11bbca9.js"><link rel="prefetch" href="/assets/js/136.d29baf7d.js"><link rel="prefetch" href="/assets/js/137.0d102a51.js"><link rel="prefetch" href="/assets/js/138.53de572f.js"><link rel="prefetch" href="/assets/js/139.35296624.js"><link rel="prefetch" href="/assets/js/14.512f15b9.js"><link rel="prefetch" href="/assets/js/140.939a9838.js"><link rel="prefetch" href="/assets/js/141.a0dbf983.js"><link rel="prefetch" href="/assets/js/142.b79d2722.js"><link rel="prefetch" href="/assets/js/143.f59c2798.js"><link rel="prefetch" href="/assets/js/144.45695bae.js"><link rel="prefetch" href="/assets/js/145.be0d5407.js"><link rel="prefetch" href="/assets/js/146.4eeb3c90.js"><link rel="prefetch" href="/assets/js/147.13a97e91.js"><link rel="prefetch" href="/assets/js/148.a9cb8c8d.js"><link rel="prefetch" href="/assets/js/149.3f1dd92d.js"><link rel="prefetch" href="/assets/js/15.a674496c.js"><link rel="prefetch" href="/assets/js/151.fc9a2f7e.js"><link rel="prefetch" href="/assets/js/152.53bd3a44.js"><link rel="prefetch" href="/assets/js/153.5607c16e.js"><link rel="prefetch" href="/assets/js/154.ad730ace.js"><link rel="prefetch" href="/assets/js/155.57d2a2cb.js"><link rel="prefetch" href="/assets/js/156.a092fa0e.js"><link rel="prefetch" href="/assets/js/157.966a0773.js"><link rel="prefetch" href="/assets/js/158.04bf03ea.js"><link rel="prefetch" href="/assets/js/159.33574240.js"><link rel="prefetch" href="/assets/js/16.ed7e507f.js"><link rel="prefetch" href="/assets/js/160.cee6d2e8.js"><link rel="prefetch" href="/assets/js/161.45a39d07.js"><link rel="prefetch" href="/assets/js/162.f40c82ce.js"><link rel="prefetch" href="/assets/js/163.a8c1cfc2.js"><link rel="prefetch" href="/assets/js/164.d57c2637.js"><link rel="prefetch" href="/assets/js/165.44596485.js"><link rel="prefetch" href="/assets/js/166.989571e6.js"><link rel="prefetch" href="/assets/js/167.d50ff3ee.js"><link rel="prefetch" href="/assets/js/168.6035f621.js"><link rel="prefetch" href="/assets/js/169.330a08ba.js"><link rel="prefetch" href="/assets/js/17.de667ca5.js"><link rel="prefetch" href="/assets/js/170.9f889b63.js"><link rel="prefetch" href="/assets/js/171.8cf81cba.js"><link rel="prefetch" href="/assets/js/172.f0d70990.js"><link rel="prefetch" href="/assets/js/173.ea277ff7.js"><link rel="prefetch" href="/assets/js/174.4a3a3c49.js"><link rel="prefetch" href="/assets/js/175.cea93f7c.js"><link rel="prefetch" href="/assets/js/176.5dd9d8fc.js"><link rel="prefetch" href="/assets/js/177.02903ac2.js"><link rel="prefetch" href="/assets/js/178.46bd7e6a.js"><link rel="prefetch" href="/assets/js/179.e69ff40a.js"><link rel="prefetch" href="/assets/js/18.b44e84af.js"><link rel="prefetch" href="/assets/js/180.710c8f29.js"><link rel="prefetch" href="/assets/js/181.8069e76c.js"><link rel="prefetch" href="/assets/js/182.4c34a2bf.js"><link rel="prefetch" href="/assets/js/183.46c4777e.js"><link rel="prefetch" href="/assets/js/184.efb2e0ea.js"><link rel="prefetch" href="/assets/js/185.f18ec0c0.js"><link rel="prefetch" href="/assets/js/186.23f2ac84.js"><link rel="prefetch" href="/assets/js/187.3b612006.js"><link rel="prefetch" href="/assets/js/188.5a59c9aa.js"><link rel="prefetch" href="/assets/js/189.cecf5612.js"><link rel="prefetch" href="/assets/js/19.5b5ad6a1.js"><link rel="prefetch" href="/assets/js/190.fefddc0e.js"><link rel="prefetch" href="/assets/js/191.e4bb534f.js"><link rel="prefetch" href="/assets/js/192.d724ea09.js"><link rel="prefetch" href="/assets/js/193.89dfe351.js"><link rel="prefetch" href="/assets/js/194.eae77bb4.js"><link rel="prefetch" href="/assets/js/195.04c629f4.js"><link rel="prefetch" href="/assets/js/196.1d478ed9.js"><link rel="prefetch" href="/assets/js/197.c1d0596a.js"><link rel="prefetch" href="/assets/js/198.16c3a6e0.js"><link rel="prefetch" href="/assets/js/199.d7abc746.js"><link rel="prefetch" href="/assets/js/20.6800493a.js"><link rel="prefetch" href="/assets/js/200.d0333b05.js"><link rel="prefetch" href="/assets/js/201.b004c4b0.js"><link rel="prefetch" href="/assets/js/202.2bdcfdad.js"><link rel="prefetch" href="/assets/js/203.3d4404c8.js"><link rel="prefetch" href="/assets/js/204.6811f526.js"><link rel="prefetch" href="/assets/js/205.dbe839ca.js"><link rel="prefetch" href="/assets/js/206.cf281ab8.js"><link rel="prefetch" href="/assets/js/207.b30ec93b.js"><link rel="prefetch" href="/assets/js/208.5bd20623.js"><link rel="prefetch" href="/assets/js/209.08173f53.js"><link rel="prefetch" href="/assets/js/21.6589052c.js"><link rel="prefetch" href="/assets/js/210.fc083767.js"><link rel="prefetch" href="/assets/js/211.a40c0012.js"><link rel="prefetch" href="/assets/js/212.ad79a40d.js"><link rel="prefetch" href="/assets/js/213.05dfd83a.js"><link rel="prefetch" href="/assets/js/214.d9155fcb.js"><link rel="prefetch" href="/assets/js/215.1884162c.js"><link rel="prefetch" href="/assets/js/216.d7e400c0.js"><link rel="prefetch" href="/assets/js/22.f648d829.js"><link rel="prefetch" href="/assets/js/23.1898021f.js"><link rel="prefetch" href="/assets/js/24.c498cdc9.js"><link rel="prefetch" href="/assets/js/25.2cf0f1ab.js"><link rel="prefetch" href="/assets/js/26.4b576a28.js"><link rel="prefetch" href="/assets/js/27.48016cde.js"><link rel="prefetch" href="/assets/js/28.fab602ac.js"><link rel="prefetch" href="/assets/js/29.2daa3972.js"><link rel="prefetch" href="/assets/js/3.13e892f5.js"><link rel="prefetch" href="/assets/js/30.495325df.js"><link rel="prefetch" href="/assets/js/31.257c7222.js"><link rel="prefetch" href="/assets/js/32.ef7a504e.js"><link rel="prefetch" href="/assets/js/33.bc231dd7.js"><link rel="prefetch" href="/assets/js/34.55a39391.js"><link rel="prefetch" href="/assets/js/35.3c4d8e9c.js"><link rel="prefetch" href="/assets/js/36.4557224c.js"><link rel="prefetch" href="/assets/js/37.e9a90f7d.js"><link rel="prefetch" href="/assets/js/38.25785bc2.js"><link rel="prefetch" href="/assets/js/39.eea4fa35.js"><link rel="prefetch" href="/assets/js/4.5bdb9365.js"><link rel="prefetch" href="/assets/js/40.b213be66.js"><link rel="prefetch" href="/assets/js/41.ab652ab8.js"><link rel="prefetch" href="/assets/js/42.a05627ab.js"><link rel="prefetch" href="/assets/js/43.f53f1b1d.js"><link rel="prefetch" href="/assets/js/44.5bb97f6d.js"><link rel="prefetch" href="/assets/js/45.4b41539d.js"><link rel="prefetch" href="/assets/js/46.1ac7cc3f.js"><link rel="prefetch" href="/assets/js/47.0580f030.js"><link rel="prefetch" href="/assets/js/48.b0904b52.js"><link rel="prefetch" href="/assets/js/49.7ce5240a.js"><link rel="prefetch" href="/assets/js/5.7c68fdb5.js"><link rel="prefetch" href="/assets/js/50.c3d83fd2.js"><link rel="prefetch" href="/assets/js/51.ba60fa98.js"><link rel="prefetch" href="/assets/js/52.7b2d060b.js"><link rel="prefetch" href="/assets/js/53.34682882.js"><link rel="prefetch" href="/assets/js/54.36faf575.js"><link rel="prefetch" href="/assets/js/55.054b9174.js"><link rel="prefetch" href="/assets/js/56.341e473a.js"><link rel="prefetch" href="/assets/js/57.f2277797.js"><link rel="prefetch" href="/assets/js/58.13a608e8.js"><link rel="prefetch" href="/assets/js/59.7d091c83.js"><link rel="prefetch" href="/assets/js/6.c8da7ca7.js"><link rel="prefetch" href="/assets/js/60.97bfc772.js"><link rel="prefetch" href="/assets/js/61.1c93e74f.js"><link rel="prefetch" href="/assets/js/62.3a202bb4.js"><link rel="prefetch" href="/assets/js/63.20335462.js"><link rel="prefetch" href="/assets/js/64.3b00af96.js"><link rel="prefetch" href="/assets/js/65.6a30f1ee.js"><link rel="prefetch" href="/assets/js/66.98d9d390.js"><link rel="prefetch" href="/assets/js/67.0864c47b.js"><link rel="prefetch" href="/assets/js/68.158bb649.js"><link rel="prefetch" href="/assets/js/69.7693303c.js"><link rel="prefetch" href="/assets/js/7.e4c88d0e.js"><link rel="prefetch" href="/assets/js/70.8b2a4075.js"><link rel="prefetch" href="/assets/js/71.a152429d.js"><link rel="prefetch" href="/assets/js/72.1ea49d1e.js"><link rel="prefetch" href="/assets/js/73.58e400b1.js"><link rel="prefetch" href="/assets/js/74.89658617.js"><link rel="prefetch" href="/assets/js/75.e4eca339.js"><link rel="prefetch" href="/assets/js/76.5ae0023e.js"><link rel="prefetch" href="/assets/js/77.b58d5308.js"><link rel="prefetch" href="/assets/js/78.4efde4e8.js"><link rel="prefetch" href="/assets/js/79.fcdba4f6.js"><link rel="prefetch" href="/assets/js/80.8fe0bd7d.js"><link rel="prefetch" href="/assets/js/81.06afa735.js"><link rel="prefetch" href="/assets/js/82.c078b99d.js"><link rel="prefetch" href="/assets/js/83.b17bc157.js"><link rel="prefetch" href="/assets/js/84.22e70000.js"><link rel="prefetch" href="/assets/js/85.7e56ce9f.js"><link rel="prefetch" href="/assets/js/86.ec79f7c8.js"><link rel="prefetch" href="/assets/js/87.94d33a73.js"><link rel="prefetch" href="/assets/js/88.e652193a.js"><link rel="prefetch" href="/assets/js/89.85faf96c.js"><link rel="prefetch" href="/assets/js/90.01d8d63c.js"><link rel="prefetch" href="/assets/js/91.e26c2ed5.js"><link rel="prefetch" href="/assets/js/92.30a511f4.js"><link rel="prefetch" href="/assets/js/93.c21eb434.js"><link rel="prefetch" href="/assets/js/94.f7611eb6.js"><link rel="prefetch" href="/assets/js/95.d443ab00.js"><link rel="prefetch" href="/assets/js/96.58237798.js"><link rel="prefetch" href="/assets/js/97.72f7f921.js"><link rel="prefetch" href="/assets/js/98.a6e4129e.js"><link rel="prefetch" href="/assets/js/99.731056a5.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5143d2e0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4a844ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/link/" class="nav-link">
  导航
</a></div><div class="nav-item"><a href="/react/" class="nav-link router-link-active">
  React
</a></div><div class="nav-item"><a href="/mdn/" class="nav-link">
  MDN
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发进阶" class="dropdown-title"><span class="title">开发进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发进阶" class="mobile-dropdown-title"><span class="title">开发进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/engineering/" class="nav-link">
  工程化
</a></li></ul></li><li class="dropdown-item"><h4>
          部署
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/deploy/" class="nav-link">
  部署
</a></li></ul></li><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/algorithm/" class="nav-link">
  算法
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端开发" class="dropdown-title"><span class="title">前端开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端开发" class="mobile-dropdown-title"><span class="title">前端开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          H5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/" class="nav-link">
  CSS
</a></li></ul></li><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          随笔
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/qa/" class="nav-link">
  QA
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发技能" class="dropdown-title"><span class="title">开发技能</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发技能" class="mobile-dropdown-title"><span class="title">开发技能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/" class="nav-link">
  数据库
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/" class="nav-link">
  后端
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="链接" class="dropdown-title"><span class="title">链接</span> <span class="arrow down"></span></button> <button type="button" aria-label="链接" class="mobile-dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://copy.aduang.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端归纳
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/chnduang/cv-collect-blog.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/link/" class="nav-link">
  导航
</a></div><div class="nav-item"><a href="/react/" class="nav-link router-link-active">
  React
</a></div><div class="nav-item"><a href="/mdn/" class="nav-link">
  MDN
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发进阶" class="dropdown-title"><span class="title">开发进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发进阶" class="mobile-dropdown-title"><span class="title">开发进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/engineering/" class="nav-link">
  工程化
</a></li></ul></li><li class="dropdown-item"><h4>
          部署
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/deploy/" class="nav-link">
  部署
</a></li></ul></li><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/algorithm/" class="nav-link">
  算法
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端开发" class="dropdown-title"><span class="title">前端开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端开发" class="mobile-dropdown-title"><span class="title">前端开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          H5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/" class="nav-link">
  CSS
</a></li></ul></li><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          随笔
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/qa/" class="nav-link">
  QA
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发技能" class="dropdown-title"><span class="title">开发技能</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发技能" class="mobile-dropdown-title"><span class="title">开发技能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/" class="nav-link">
  数据库
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/" class="nav-link">
  后端
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="链接" class="dropdown-title"><span class="title">链接</span> <span class="arrow down"></span></button> <button type="button" aria-label="链接" class="mobile-dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://copy.aduang.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端归纳
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/chnduang/cv-collect-blog.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/react/" aria-current="page" class="sidebar-link">目录</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/1-基础" class="sidebar-heading clickable"><span>基础</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/2-class" class="sidebar-heading clickable"><span>class</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/3-hooks" class="sidebar-heading clickable router-link-active open"><span>hooks</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/3-hooks/" aria-current="page" class="sidebar-link">目录</a></li><li><a href="/react/3-hooks/hooks与Faced模式.html" class="sidebar-link">React hooks与Faced模式才是最佳实践?</a></li><li><a href="/react/3-hooks/memo和useMemo的用法与区别.html" class="active sidebar-link">React.memo() 和 useMemo() 的用法与区别</a></li><li><a href="/react/3-hooks/react-hooks大串讲.html" class="sidebar-link">react-hooks 大串讲</a></li><li><a href="/react/3-hooks/不要再滥用useMemo了.html" class="sidebar-link">不要再滥用useMemo了！你应该重新思考Hooks memoization</a></li><li><a href="/react/3-hooks/从函数式组件看Hooks设计.html" class="sidebar-link">从函数式组件看 Hooks 设计</a></li><li><a href="/react/3-hooks/理解useReducer的优势和高级用法.html" class="sidebar-link">【React的作弊模式】理解useReducer的优势和高级用法</a></li><li><a href="/react/3-hooks/说说对React-Hooks的理解.html" class="sidebar-link">说说对React Hooks的理解？解决了什么问题？</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/4-性能优化" class="sidebar-heading clickable"><span>性能优化</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/5-ssr" class="sidebar-heading clickable"><span>ssr</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/6-源码解析" class="sidebar-heading clickable"><span>源码解析</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react-memo-和-usememo-的用法与区别"><a href="#react-memo-和-usememo-的用法与区别" class="header-anchor">#</a> React.memo() 和 useMemo() 的用法与区别</h1> <blockquote><p><a href="https://mp.weixin.qq.com/s/zxT2GfujdbQfvrCtRxkbiQ" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/zxT2GfujdbQfvrCtRxkbiQ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>在软件开发中，我们通常痴迷于性能提升以及如何使我们的应用程序执行得更快，从而为用户提供更好的体验。</p> <p>Memoization 是优化性能的方法之一。在本文中，我们将探讨它在 React 中的工作原理。</p> <h2 id="什么是-memoization"><a href="#什么是-memoization" class="header-anchor">#</a> <strong>什么是 memoization？</strong></h2> <p>在解释这个概念之前，让我们先来看一个简单的斐波那契程序：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span> n <span class="token operator">:</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>显然这个算法缓慢的令人绝望，因为做了非常多的冗余计算，这个时候<code>memoization</code>就可以派上用场了。</p> <p>简单来说，<code>memoization</code> 是一个过程，它允许我们缓存递归/昂贵的函数调用的值，以便下次使用相同的参数调用函数时，返回缓存的值而不必重新计算函数。</p> <p>这确保了我们的应用程序运行得更快，因为我们通过返回一个已经存储在内存中的值来避免重新执行函数需要的时间。</p> <h2 id="为什么在-react-中使用-memoization"><a href="#为什么在-react-中使用-memoization" class="header-anchor">#</a> <strong>为什么在 React 中使用 memoization？</strong></h2> <p>在 React 函数组件中，当组件中的 props 发生变化时，默认情况下整个组件都会重新渲染。换句话说，如果组件中的任何值更新，整个组件将重新渲染，包括尚未更改其 values/props 的函数/组件。</p> <p>让我们看一个发生这种情况的简单示例。我们将构建一个基本的应用程序，告诉用户哪种酒最适合与它们选择的奶酪搭配。</p> <p>我们将从设置两个组件开始。第一个组件将允许用户选择奶酪。然后它会显示最适合该奶酪的酒的名称。第二个组件将是第一个组件的子组件。在这个组件中，没有任何变化。我们将使用这个组件来跟踪 React 重新渲染的次数。</p> <blockquote><p>注意，本示例中使用的 <code>classNames</code> 来自 Tailwind CSS。</p></blockquote> <p>下面是我们的父组件：<code>&lt;ParentComponent /&gt;</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// components/parent-component.js</span>
<span class="token keyword">import</span> Counts <span class="token keyword">from</span> <span class="token string">&quot;./counts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Button <span class="token keyword">from</span> <span class="token string">&quot;./button&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> constants <span class="token keyword">from</span> <span class="token string">&quot;../utils&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">MOZARELLA</span><span class="token punctuation">,</span> <span class="token constant">CHEDDAR</span><span class="token punctuation">,</span> <span class="token constant">PARMESAN</span><span class="token punctuation">,</span> <span class="token constant">CABERNET</span><span class="token punctuation">,</span> <span class="token constant">CHARDONAY</span><span class="token punctuation">,</span> <span class="token constant">MERLOT</span> <span class="token punctuation">}</span> <span class="token operator">=</span> constants<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">ParentComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>cheeseType<span class="token punctuation">,</span> setCheeseType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>wine<span class="token punctuation">,</span> setWine<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">whichWineGoesBest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>cheeseType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token constant">MOZARELLA</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token function">setWine</span><span class="token punctuation">(</span><span class="token constant">CABERNET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token constant">CHEDDAR</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token function">setWine</span><span class="token punctuation">(</span><span class="token constant">CHARDONAY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token constant">PARMESAN</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token function">setWine</span><span class="token punctuation">(</span><span class="token constant">MERLOT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token constant">CHARDONAY</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> mounted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">whichWineGoesBest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>mounted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>cheeseType<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;flex flex-col justify-center items-center&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h3 className<span class="token operator">=</span><span class="token string">&quot;text-center dark:text-gray-400 mt-10&quot;</span><span class="token operator">&gt;</span>
          Without React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> or <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1 className<span class="token operator">=</span><span class="token string">&quot;font-semibold text-2xl dark:text-white max-w-md text-center&quot;</span><span class="token operator">&gt;</span>
        Select a cheese and we will tell you which wine goes best<span class="token operator">!</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;flex flex-col gap-4 mt-10&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Button text<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">MOZARELLA</span><span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCheeseType</span><span class="token punctuation">(</span><span class="token constant">MOZARELLA</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Button text<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">CHEDDAR</span><span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCheeseType</span><span class="token punctuation">(</span><span class="token constant">CHEDDAR</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Button text<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">PARMESAN</span><span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCheeseType</span><span class="token punctuation">(</span><span class="token constant">PARMESAN</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>cheeseType <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token string">&quot;mt-5 dark:text-green-400 font-semibold&quot;</span><span class="token operator">&gt;</span>
          For <span class="token punctuation">{</span>cheeseType<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">&quot;dark:text-yellow-500&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>wine<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token string">&quot; &quot;</span><span class="token punctuation">}</span>
          goes best<span class="token punctuation">.</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>Counts <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>第二个组件是 <code>&lt;Counts /&gt;</code> 组件，它跟踪整个 <code>&lt;Parent Component /&gt;</code> 组件重新渲染的次数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// components/counts.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Counts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> renderCount <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;mt-3&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token string">&quot;dark:text-white&quot;</span><span class="token operator">&gt;</span>
        Nothing has changed here but <span class="token constant">I</span>'ve now rendered<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot; &quot;</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">&quot;dark:text-green-300 text-grey-900&quot;</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token punctuation">(</span>renderCount<span class="token punctuation">.</span>current<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token function">time</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>下面的例子是我们点击奶酪名字时的效果:</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_gif/xsw6Lt5pDCsgTzftWYvhdTTE8MZ0abzKRAthia2kJNhCxh5sT5m2P6BrhOgjNnskxjSibfdm7bo3zOgTegCVia61Q/640?wx_fmt=gif&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="图片"></p> <p><code>&lt;ParentComponent /&gt;</code> 中的 <code>&lt;Counts /&gt;</code> 组件计算了因 <code>&lt;ParentComponent /&gt;</code> 的更改而强制 <code>&lt;Counts /&gt;</code> 组件重新渲染的次数。</p> <p>目前，单击奶酪名字将更新显示下面的奶酪名字以及酒名。除了 <code>&lt;ParentComponent /&gt;</code> 会重新渲染，<code>&lt;Counts /&gt;</code> 组件也会重新渲染，即使其中的任何内容都没有改变。</p> <p>想象一下，有一个组件显示数以千计的数据，每次用户单击一个按钮时，该组件或树中的每条数据都会在不需要更新时重新渲染。这就是 <code>React.memo()</code> 或 <code>useMemo()</code> 为我们提供性能优化所必需的地方。</p> <p>现在，让我们探索 <code>React.memo</code> 以及 <code>useMemo()</code>。之后我们将比较它们之间的差异，并了解何时应该使用一种而不是另一种。</p> <h2 id="什么是-react-memo"><a href="#什么是-react-memo" class="header-anchor">#</a> <strong>什么是 React.memo()？</strong></h2> <p><code>React.memo()</code> 随 React v16.6 一起发布。虽然类组件已经允许您使用 PureComponent 或 shouldComponentUpdate 来控制重新渲染，但 React 16.6 引入了对函数组件执行相同操作的能力。</p> <p><code>React.memo()</code> 是一个高阶组件 (HOC**)，**它接收一个组件A作为参数并返回一个组件B，如果组件B的 props（或其中的值）没有改变，则组件 B 会阻止组件 A 重新渲染 。</p> <p>我们将采用上面相同的示例，但在我们的 <code>&lt;Counts /&gt;</code> 组件中使用 <code>React.memo()</code>。我们需要做的就是用 <code>React.memo()</code> 包裹我们的 <code>&lt;Counts /&gt;</code>组件，如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Counts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> renderCount <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;mt-3&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token string">&quot;dark:text-white&quot;</span><span class="token operator">&gt;</span>
        Nothing has changed here but <span class="token constant">I</span>'ve now rendered<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot; &quot;</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">&quot;dark:text-green-300 text-grey-900&quot;</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token punctuation">(</span>renderCount<span class="token punctuation">.</span>current <span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token function">time</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>Counts<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>现在，当我们通过单击选择奶酪类型时，我们的 <code>&lt;Counts /&gt;</code> 组件将不会重新渲染。</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_gif/xsw6Lt5pDCsgTzftWYvhdTTE8MZ0abzKVE1Ea4WtYRjwhV4NMPo5iaA3OVKkf4bJEpcVyaOCMiaDbTLnWD5Ic0RQ/640?wx_fmt=gif&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="图片"></p> <h2 id="什么是-usememo"><a href="#什么是-usememo" class="header-anchor">#</a> <strong>什么是 useMemo()？</strong></h2> <p><code>React.memo()</code> 是一个 HOC，而 <code>**useMemo()**</code> 是一个 React Hook。使用 <code>useMemo()</code>，我们可以返回记忆值来避免函数的依赖项没有改变的情况下重新渲染。</p> <p>为了在我们的代码中使用 <code>useMemo()</code>，React 开发者有一些建议给我们：</p> <ul><li><strong>您可以依赖</strong> <code>useMemo()</code> <strong>作为性能优化，而不是语义保证</strong></li> <li><strong>函数内部引用的每个值也应该出现在依赖项数组中</strong></li></ul> <p>对于我们的下一个示例，我们将对 <code>&lt;ParentComponent /&gt;</code> 进行一些更改。下面的代码仅显示对我们之前创建的 <code>&lt;ParentComponent /&gt;</code> 的新更改。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// components/parent-component.js</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useMemo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> UseMemoCounts <span class="token keyword">from</span> <span class="token string">&quot;./use-memo-counts&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">ParentComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span>
  <span class="token punctuation">.</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>times<span class="token punctuation">,</span> setTimes<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> useMemoRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">incrementUseMemoRef</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> useMemoRef<span class="token punctuation">.</span>current<span class="token operator">++</span><span class="token punctuation">;</span>

  <span class="token comment">// uncomment the next line to test that &lt;UseMemoCounts /&gt; will re-render every t ime the parent re-renders.</span>
  <span class="token comment">// const memoizedValue = useMemoRef.current++;</span>

<span class="token comment">// the next line ensures that &lt;UseMemoCounts /&gt; only renders when the times value changes</span>
<span class="token keyword">const</span> memoizedValue <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">incrementUseMemoRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>times<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">.</span>
  <span class="token punctuation">.</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;flex flex-col justify-center items-center border-2 rounded-md mt-5 dark:border-yellow-200 max-w-lg m-auto pb-10 bg-gray-900&quot;</span><span class="token operator">&gt;</span>
      <span class="token punctuation">.</span>
      <span class="token punctuation">.</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;mt-4 text-center&quot;</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>button
            className<span class="token operator">=</span><span class="token string">&quot;bg-indigo-200 py-2 px-10 rounded-md&quot;</span>
            onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimes</span><span class="token punctuation">(</span>times<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">&gt;</span>
            Force render
          <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span>UseMemoCounts memoizedValue<span class="token operator">=</span><span class="token punctuation">{</span>memoizedValue<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>首先，我们引入了非常重要的 <code>useMemo()</code> Hook。我们还引入了 <code>useRef()</code> Hook 来帮助我们跟踪在我们的组件中发生了多少次重新渲染。接下来，我们声明一个 <code>times</code> 状态，稍后我们将更新该状态来触发/强制重新渲染。</p> <p>之后，我们声明一个 <code>memoizedValue</code> 变量，用于存储 <code>useMemo()</code> Hook 的返回值。<code>useMemo()</code> Hook 调用我们的 <code>incrementUseMemoRef</code> 函数，它会在每次依赖项发生变化时将我们的 <code>useMemoRef.current</code> 值加一，即 <code>times</code> 值发生变化。</p> <p>然后我们创建一个按钮来点击更新<code>times</code>的值。单击此按钮将触发我们的 <code>useMemo()</code> Hook，更新 <code>memoizedValue</code> 的值，并重新渲染我们的 <code>&lt;UseMemoCounts /&gt;</code> 组件。</p> <p>在这个例子中，我们还将 <code>&lt;Counts /&gt;</code> 组件重命名为 <code>&lt;UseMemoCounts /&gt;</code>，它现在需要一个 <code>memoizedValue</code> 属性。</p> <p>这是它的样子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// components/use-memo-counts.js</span>

<span class="token keyword">function</span> <span class="token function">UseMemoCounts</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>memoizedValue<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;mt-3&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token string">&quot;dark:text-white max-w-md&quot;</span><span class="token operator">&gt;</span>
        <span class="token constant">I</span>'ll only re<span class="token operator">-</span>render when you click <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">&quot;font-bold text-indigo-400&quot;</span><span class="token operator">&gt;</span>Force render<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span> 
        <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token string">&quot;dark:text-white&quot;</span><span class="token operator">&gt;</span><span class="token constant">I</span>'ve now rendered<span class="token operator">:</span> <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">&quot;text-green-400&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>memoizedValue<span class="token punctuation">}</span> <span class="token function">time</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> UseMemoCounts<span class="token punctuation">;</span>
</code></pre></div><p>现在，当我们单击任何奶酪按钮时，我们的 <code>memoizedValue</code> 不会更新。但是当我们单击 <strong>Force render</strong> 按钮时，我们看到 <code>memoizedValue</code> 更新并且 <code>&lt;UseMemoCounts /&gt;</code> 组件重新渲染。</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_gif/xsw6Lt5pDCsgTzftWYvhdTTE8MZ0abzKah78nEaO3rEzzCxnkp3t1K3TNGOYEMM7eZd65YQ1Ta9wP5xUXxTib4A/640?wx_fmt=gif&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="图片"></p> <p>如果注释掉我们当前的 memoizedValue行，并取消注释掉它上面的行：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> memoizedValue <span class="token operator">=</span> useMemoRef<span class="token punctuation">.</span>current<span class="token operator">++</span><span class="token punctuation">;</span>
</code></pre></div><p>将看到 <code>&lt;UseMemoCounts /&gt;</code> 组件在每次 <code>&lt;ParentComponent /&gt;</code> 渲染时重新渲染。</p> <h2 id="总结-react-memo-和-usememo-的主要区别"><a href="#总结-react-memo-和-usememo-的主要区别" class="header-anchor">#</a> <strong>总结：React.memo() 和 useMemo() 的主要区别</strong></h2> <p>从上面的例子中，我们可以看到 <code>React.memo()</code> 和 <code>useMemo()</code> 之间的主要区别：</p> <ul><li><code>**React.memo()**</code> <strong>是一个高阶组件，我们可以使用它来包装我们不想重新渲染的组件，除非其中的 props 发生变化。</strong></li> <li><code>**useMemo()**</code> <strong>是一个 React Hook，我们可以使用它在组件中包装函数。我们可以使用它来确保该函数中的值仅在其依赖项之一发生变化时才重新计算。</strong></li></ul> <p>虽然 memoization 似乎是一个可以随处使用的巧妙小技巧，但只有在绝对需要这些性能提升时才应该使用它。Memoization 会占用运行它的机器上的内存空间，因此可能会导致意想不到的效果。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">11/8/2024, 10:19:43 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/react/3-hooks/hooks与Faced模式.html" class="prev">
        React hooks与Faced模式才是最佳实践?
      </a></span> <span class="next"><a href="/react/3-hooks/react-hooks大串讲.html">
        react-hooks 大串讲
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.447fea52.js" defer></script><script src="/assets/js/2.57da4f88.js" defer></script><script src="/assets/js/1.a76cc220.js" defer></script><script src="/assets/js/150.56dd1be8.js" defer></script>
  </body>
</html>
